#[test]
fn for_loop_table_fill {
  val t = {};

  for (rw val i = 0; i < 4; i++) {
    t[i] = i;
  }

  assert.equal(t[0], 0);
  assert.equal(t[1], 1);
  assert.equal(t[2], 2);
  assert.equal(t[3], 3);
}


#[test]
fn for_loop_closure_capture {
  val funcs = {};

  for (rw val i = 0; i < 3; i++) {
    funcs[i] = fn -> i;
  }

  assert.equal(funcs[0](), 0);
  assert.equal(funcs[1](), 1);
  assert.equal(funcs[2](), 2);
}

fn delay(ms) { 
  val end = time.stamp.ms + ms;
  while(time.stamp.ms < end){}

  ret 2.137;
}

#[test]
fn tonum_indexing {
  val data = { a: { b: { c: "1", d: "2", e: "3", f: "4" } } };
  val x = $data.a.b.c * $data.a.b.d;

  assert.equal(x, 2);
}

#[test]
fn type_as_string -> assert.equal(
  @typeof(nil), "Nil"
);

loc fn test_yield -> 2137;

#[test]
fn yield_unary -> assert.equal(
  @yield<test_yield>(), "2137"
);