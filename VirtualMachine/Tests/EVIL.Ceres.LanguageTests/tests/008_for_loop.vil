#[test]
fn for_simple {
  rw val i;
  for (i = 0; i < 10; ++i) {}
  
  assert.equal(i, 10);
}

#[test]
fn for_simple_skip {
  rw val i;
  
  for (i = 0; i < 10; i++) {
    skip;
  }
  
  assert.equal(i, 10);
}

#[test]
fn for_simple_break {
  rw val i;
  
  for (i = 0; i < 10; i++) {
    if (i == 5)
      break;
  }
  
  assert.equal(i, 5);
}

#[test]
fn for_nested {
  rw val i, j, k;
  
  for (i = 0; i < 10; i++) {
    for (j = 0; j < 10; j++) {
      for (k = 0; k < 10; k++) { }
    }
  }
  
  assert.equal(i, 10);
  assert.equal(j, 10);
  assert.equal(k, 10);
}

#[test]
fn for_nested_break {
  rw val broken = false;
  rw val i;
  
  for (i = 10; i < 11; i++) {
    // todo implement discard pattern
    for (_=_; true; i--) {
      if (i == 6) {
        broken = true;
        break;
      }
    }
    
    if (broken) {
      break;
    }
  }
  
  assert.equal(i, 6);
}

#[test]
fn for_multiple_statements {
  rw val i;
  rw val j;
  
  for (i = 0, j = 0; i < 10; i++, j += 2) { }
  
  assert.equal(i, 10);
  assert.equal(j, 20);
}

#[test]
fn for_loop_mutates_limit {
  rw val i, limit = 5;

  for (i = 0; i < limit; i++) {
    if (i == 2) limit = 10;
  }

  assert.equal(i, 10);
}

#[test]
fn for_loop_nested_skip_break {
  rw val count = 0;

  for (rw val i = 0; i < 5; i++) {
    for (rw val j = 0; j < 5; j++) {
      if (j == 2) skip;
      if (j == 4) break;
      count += 1;
    }
  }

  /* j=0,1,3; i=0..4 → 3 * 5 = 15 */
  assert.equal(count, 15);
}

#[test]
fn for_skip_increment {
  rw val i = 0, count = 0;

  for (i; i < 10; i) {
    if (i % 2 == 0) {
      i++;
      skip;
    }

    count++;
    i++;
  }

  assert.equal(count, 5);
  assert.equal(i, 10);
}